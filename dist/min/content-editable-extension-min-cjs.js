"use strict";function t(t){var e,n=t.commonAncestorContainer,o=1,i=0;if(n===this.dom)return o;for(;(n=n.parentElement)&&!i;){"BODY"===n.nodeName?(o=(e=[0,1])[0],i=e[1]):n===this.dom&&(i=1)}return o}var e=function(){function e(t,e,n){if(void 0===e&&(e=0),void 0===n&&(n=function(){}),!t)throw Error("Params dom is not null");this.dom=t,this.associateHandleCb=n,this.setContentEditable(),e&&this.addChangeEvent()}return e.prototype.setContentEditable=function(){var t=this.dom,e=t.getAttribute("contenteditable");e&&"false"!==e||t.setAttribute("contenteditable","true")},e.prototype.addChangeEvent=function(){var t=this;this.dom.addEventListener("input",(function(e){e.target.innerHTML;var n=window.getSelection(),o=function(t){var e={isNeed:0,inputStr:""},n=/@(\w|[\u4e00-\u9fa5])+$/;if(n.test(t)){e.isNeed=1;var o=n.exec(t)||[];e.inputStr=o[0]||""}return e}((null==n?void 0:n.getRangeAt(0)).commonAncestorContainer.textContent||"");console.log(o),t.associateHandleCb(o)}))},e.prototype.insert=function(n,o){if(o&&e.setCursorToLast(this.dom),window.getSelection){var i=window.getSelection(),r=i.getRangeAt(0);if(!t.call(this,r))return;if((null==i?void 0:i.getRangeAt)&&i.rangeCount){var l=document.createElement("div"),a=null;l.innerHTML=n;for(var s=document.createDocumentFragment(),c=void 0,d=void 0;c=l.firstChild;)d=s.appendChild(c);if(o){var u=r.commonAncestorContainer.childNodes,f=u.length;a=u[f-1];for(var g=f-1;g>=0;g--){var m=u[g],v=m.textContent;if(v&&v.includes("@")){var p=v.lastIndexOf("@");m.textContent=v.substring(0,p+1);break}}}a&&"DIV"===a.nodeName?a.appendChild(s):null==r||r.insertNode(s),d&&(null==(r=null==r?void 0:r.cloneRange())||r.setStartAfter(d),null==r||r.collapse(!0),i.removeAllRanges(),i.addRange(r))}else"Control"!==document.selection.type&&document.selection.createRange().pastHTML(n)}},e.setCursorToLast=function(t){if(!t)throw Error("Params dom is not null");if(window.getSelection){t.focus();var e=window.getSelection();null==e||e.selectAllChildren(t),null==e||e.collapseToEnd()}else if(document.selection){var n=document.selection.createRange();n.moveToElementText(t),n.collapse(!1),n.select()}},e.setPositionOfAssociateList=function(t,e){var n;if(!t)throw Error("Params associateList is not null");if(window.getSelection){var o=window.getSelection().getRangeAt(0).commonAncestorContainer,i=document.createRange();i.selectNodeContents(o);var r=e.getBoundingClientRect(),l=Object.prototype.hasOwnProperty.call(i,"getBoundingClientRect")?i.getBoundingClientRect():i.getClientRects()[0],a=(null===(n=o.textContent)||void 0===n?void 0:n.lastIndexOf("@"))||0;t.style.position="absolute",t.style.left=l.left-r.left+12*a+"px",t.style.top=l.top-r.top+20+"px"}},e.prototype.getValue=function(){return this.dom.innerHTML},e}();module.exports=e;
